<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="../js/common/jquery.min.1.10.2.js"></script>
</head>
<body>
<script>
  var getUrlparam = function(name) {
      var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
      var r = window.location.search.substr(1).match(reg);
      if (r != null) {
          return decodeURI(r[2]);
      }
      return null;
  };  
  var code = getUrlparam('code');
  var state = getUrlparam('state');
  var imgurl = getUrlparam('imgurl')
  var fromUrl = imgurl?(getUrlparam('fromUrl')+'&imgurl='+imgurl):'index.html';
  $.ajax({
      url:'/oAuthServlet',
      type: "get",
      dataType: "json",
      data:{
          code:code,
          state:state
      },
      success: function(data) {
        //alert("code:"+code+"---state:"+state+"----用户信息:"+JSON.stringify(data));
          window.localStorage.setItem("userinfo",JSON.stringify(data));
          location.href= fromUrl;
      },
      error:function(data){
        App.toast("系统连接超时");
      }
  });
</script>
</body>
</html>